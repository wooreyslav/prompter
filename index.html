<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Суфлёр">
<title>Суфлёр</title>
<style>
html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #000;
      color: #fff;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

#progress {
      position: fixed;
      top: 0;
      left: 0;
      height: 6px;
      width: 0%;
      background: #ff00bf;
      transition: width 0.4s ease;
      z-index: 1000;
    }

#text {
      flex: 1;
      font-size: 40px;
      line-height: 1.4;
      padding: 0px 20px;
      white-space: pre;
      text-align: left;
      overflow: hidden;
    }

#controls {
      display: flex;
      justify-content: space-around;
      align-items: center;
      background: rgba(255, 255, 255, 0.05);
      padding: 12px 0;
      border-top: 1px solid rgba(255, 255, 255, 0.2);
    }

button {
      background: #111;
      color: #fff;
      border: 1px solid #ff00bf;
      border-radius: 8px;
      font-size: 22px;
      padding: 10px 18px;
      cursor: pointer;
      transition: 0.2s ease;
    }

button:hover {
      background: #ff00bf;
      color: #000;
    }

.label {
    font-size: 0.7em;
    opacity: 0.5;
    font-style: italic;
}


.song-title {
    position: fixed;
    top: 2px;
    left: 0;
    width: 100%;
    text-align: center;
    font-size: 0.7em;
    font-weight: bold;
    opacity: 0.8;
}

.small-gap {
  height: 0.6em; /* половина стандартного абзацного отступа */
}

</style>
</head>
<body>

<div id="progress"></div>
<div id="text"></div>

<div id="controls">
  <button id="prevSection">⬅️ Секция</button>
  <button id="nextSection">➡️ Секция</button>
  <button id="prevSong">⏪ Песня</button>
  <button id="nextSong">⏩ Песня</button>
</div>

<script>
const songText = `<div class="song-title">ОСТАНОВКА (BPM 112)</div>
<div class="label">[куплет 1]</div>Последний трамвай идет до депо
Я звезды черчу в запотевшем окне
Вроде опоздал, но мне все равно 
И, впрочем, не уверен даже в завтрашнем дне

Внезапно я понял, что это мой шанс
Узнать твое имя, пойти за тобой
Твой след - мой навигатор, покинутый трамвай
Откуда тебе знать, что я за твоей спиной
---
<div class="song-title">ОСТАНОВКА (BPM 112)</div>
<div class="label">[припев 1]</div>Мне нужен только повод
Сделать первый шаг
Чтоб я бежал стоптав
В пыли свои кроссовки

Возможно, повод - ты
Подумал я дурак
Случайно выйдя с тобой
Не на своей остановке
---
<div class="song-title">ОСТАНОВКА (BPM 112)</div>
<div class="label">[куплет 2]</div>Квартал за кварталом, закрытый «КБ»
Тропинка до дома дождливым сентябрём
Тебе не узнать, что могло бы случится
Останься мы здесь совершенно вдвоем

Представь, как мы расскажем всем твоим друзьям
О встрече на рельсах, как будто бы в кино
Но ты ускоришь шаг, подумав я маньяк
Торопливо ища ключи в своем пальто
---
<div class="song-title">ОСТАНОВКА (BPM 112)</div>
<div class="label">[припев 2]</div>Мне нужен только повод
Сделать первый шаг
Чтоб я бежал стоптав
В пыли свои кроссовки

Возможно, повод - ты
Подумал я дурак
Случайно выйдя с тобой
Не на своей остановке
----
<div class="song-title">ПАРЕНЬ НА ФОТО (BPM 104)</div>
<div class="label">[куплет 1]</div>Я давно не у дел, забил болт на работу
Я один, но в порядке, поверь все нормально
На часах полшестого, ностальгия напала
Вспоминаю былое, ты была идеальна
<div class="label">[припев 1]</div>Мое старое худи пропахло тобой
На балконе окурки и шумы объездной
Под слоями вещей, в глубинах комода
Улыбается твой бывший парень на фото
---
<div class="song-title">ПАРЕНЬ НА ФОТО (BPM 104)</div>
<div class="label">[куплет 2]</div>Этот мир уже давно перестал крутиться, 
Запахи цветов обернулись пылью
Образы в голове затянула тоска
Прокрутил много раз то, что должен сказать:

Все эти моменты, на которых мы выросли, все эти порезы на наших руках
Синдром отложенной жизни? Да к черту, Я растворяю себя в пустяках
Я просто хотел стать важной частичкой жизни твоей, но что-то не вышло
Остаться забытой памятью лета тоже неплохо наверно!
---
<div class="song-title">ПАРЕНЬ НА ФОТО (BPM 104)</div>
<div class="label">[припев 2]</div>Мое старое худи пропахло тобой
На балконе окурки и шумы объездной
Под слоями вещей, в глубинах комода
Улыбается твой бывший парень на фото
----
<div class="song-title">2000 КМ (BPM 98)</div>
<div class="label">[куплет 1]</div>Миллионы сообщений и пара дней с тобой в Москве 
Я, кажется, влюбился, додумав все в голове
А может ты захочешь купить билет в Кольцово
Было бы мило нам увидеться снова
<div class="label">[припев 1]</div>Я буду тебя ждать здесь на Вознесенской горке
И солнце на закате робко улыбнется
Она не приедет, я встречу рассвет один
2000 километров растворили эндорфин
---
<div class="song-title">2000 КМ (BPM 98)</div>
<div class="label">[куплет 2]</div>Ну как ты там в своей Москве, восьмиполосные шоссе
Они обвили все вокруг и заглушили сердца стук
И я, наверное, скучаю внутри ненависть копя
Я ненавижу город твой чуть больше, чем люблю тебя
<div class="label">[припев 2]</div>Я буду тебя ждать здесь на Вознесенской горке
И солнце на закате робко улыбнется
Она не приедет, я встречу рассвет один
2000 километров растворили эндорфин
----
<div class="song-title">СНОВА НЕ ЗДЕСЬ (BPM 118)</div>
<div class="label">[куплет 1]</div>Ночь. Свет фонаря и безумных идей
Освещая шаги под окном
Упавшие листья прожитых дней
Оказались вновь увиденным сном

В светлой ночи и свежести лета
Бежать с ведром KFC
Я хотел бы вернуть то время назад
Господи, сохрани и спаси
---
<div class="song-title">СНОВА НЕ ЗДЕСЬ (BPM 118)</div>
<div class="label">[куплет 2]</div>Электрических скрежет когтей
И десятки ночных поездов
Принесут нам новых идей
И избавят от древних оков

...на мутном окне
Крадущийся грохот снаружи
Голос нашедший ответ в тишине
И кто-то по-прежнему нужен
----
<div class="song-title">НЕТУ НАС (BPM 99)</div>
<div class="label">[куплет 1]</div>О боже сколько раз 
Перебирать что со мной было
Забыть все то о нас 
Что голову забило

Стереть всю память лет 
Выбросить все твои вещи 
Остаться в прошлом легче чем 
Сказать "прощай, до встречи" 
---
<div class="song-title">НЕТУ НАС (BPM 99)</div>
<div class="label">[припев 1]</div>Но нету, нету нас 
Я забываю твое имя 
И после сотни избытых фраз 
Меня в итоге отпустило 
---
<div class="song-title">НЕТУ НАС (BPM 99)</div>
<div class="label">[куплет 2]</div>Забудь про искры тёмных глаз — 
В них больше нет былой надежды 
Они сгорели, как грехи, 
На вечеринке без одежды. 

Смех до утра, фотки в альбоме 
Теперь мы просто "ну, знакомы" 
---
<div class="song-title">НЕТУ НАС (BPM 99)</div>
<div class="label">[припев 2]</div>Но нету, нету нас 
Я забываю твое имя 
И после сотни избытых фраз 
Меня в итоге отпустило
----
<div class="song-title">СУПЕРМАРКЕТ (BPM 144)</div>
<div class="label">[куплет 1]</div>Мигают товары, зовут за собой 
Карусель скидок крутит толпой 
Катишься дальше по этим путям 
Ты купишь покой, но не нужен он сам 

Обыденно и просто, никакой спешки 
Двери открыты, полезай в тележку 
---
<div class="song-title">СУПЕРМАРКЕТ (BPM 144)</div>
<div class="label">[куплет 2]</div>А ты всю ночь и до рассветных огней 
Рыщишь по улицам в свете фонарей 
А ты всю ночь и до рассветных огней 
Погряз навеки в супермаркете идей 

Вдоль бакалеи по третьему кругу 
На третьей кассе увидим друг друга 
----
<div class="song-title">ТЕПЛИЦА (BPM 110)</div>
<div class="label">[куплет 1]</div>Теплица мой дом, в теплице спокойно
Ноги мои прочно вросли
За стеклом кружат убийцы
Готовы сорвать меня целиком
<div class="label">[припев 1]</div>Запах табака и самокруток
Это не беда - слетел с катушек
Зажигалки свет путь освещает
---
<div class="song-title">ТЕПЛИЦА (BPM 110)</div>
<div class="label">[куплет 2]</div>В зеркале разбитый
Памяти нет совсем
Долги обвили шею
А шея висит в петле
<div class="label">[припев 2]</div>Запах табака и самокруток
Это не беда - слетел с катушек
Зажигалки свет путь освещает
----
<div class="song-title">БЕЛЫЙ ШУМ (BPM 104)</div>
<div class="label">[куплет 1]</div>Белый шум телевизора в углу
Не спешу писать тебе, я опять один лежу
Вся одежда свалена, перерезал провода
Стук часов не даст заснуть, медленно схожу с ума
<div class="label">[куплет 2]</div>Еда на доставке, задернуты шторы
Мой поезд диван, мой дом одиночество
Я просто держусь за остатки сознания
Мое одиночество на все оправдание
---
<div class="song-title">БЕЛЫЙ ШУМ (BPM 104)</div>
<div class="label">[пре-припев]</div>Я день и ночь поменял местами
Растворенный синего света тонами
<div class="label">[припев]</div>Прости меня, я не в состоянии
Поднять себя и из дома выйти
Мой сон ушел с последней банкой кофе
На улицы, где никто не ждет меня
Не ждет меня
<div class="label">[аутро]</div>Я день и ночь поменял местами
Растворенный синего света тонами
`;

// ====== РАЗБИЕНИЕ ======
const rawSongs = songText.trim().split(/\r?\n-{4,}\r?\n/).map(s => s.trim());
const songs = rawSongs.map(song => song.split(/\r?\n-{3,}\r?\n/).map(s => s.trim()));

// плоский массив всех секций (для сквозного перелистывания)
const allSections = [];
const sectionMap = []; // соответствие "глобальная секция → песня"

songs.forEach((song, songIndex) => {
  song.forEach(section => {
    allSections.push(section);
    sectionMap.push(songIndex);
  });
});

let currentSectionGlobal = 0;

const textEl = document.getElementById('text');
const progressEl = document.getElementById('progress');

function adjustFontSize() {
  textEl.style.fontSize = '42px';
  textEl.style.transform = 'none';
  textEl.style.width = '100%'; // сброс предыдущего

  const containerWidth = textEl.clientWidth;
  const contentWidth = textEl.scrollWidth;

  if (contentWidth > containerWidth) {
    const scale = containerWidth / contentWidth;

    textEl.style.transformOrigin = 'left top';
    textEl.style.transform = `scaleX(${scale})`;

    // 🟢 ВАЖНО: гарантируем, что контейнер реально заужен
    textEl.style.width = (contentWidth * scale) + 'px';
  }
}


function updateProgress() {
  const percent = ((currentSectionGlobal + 1) / allSections.length) * 100;
  progressEl.style.width = percent + '%';
}

function showSection(globalIndex) {
  if (globalIndex < 0) globalIndex = 0;
  if (globalIndex >= allSections.length) globalIndex = allSections.length - 1;
  currentSectionGlobal = globalIndex;

  let html = allSections[globalIndex];

  // ✅ уменьшенный отступ между абзацами
  html = html.replace(/\n\n+/g, '<div class="small-gap"></div>');

  textEl.innerHTML = html;
  adjustFontSize();
  updateProgress();
}


function nextSection() { showSection(currentSectionGlobal + 1); }
function prevSection() { showSection(currentSectionGlobal - 1); }

function nextSong() {
  const currentSong = sectionMap[currentSectionGlobal];
  if (currentSong < songs.length - 1) {
    // перейти к первой секции следующей песни
    const nextIndex = sectionMap.indexOf(currentSong + 1);
    showSection(nextIndex);
  }
}

function prevSong() {
  const currentSong = sectionMap[currentSectionGlobal];
  if (currentSong > 0) {
    // перейти к первой секции предыдущей песни
    const prevIndex = sectionMap.indexOf(currentSong - 1);
    showSection(prevIndex);
  }
}

// ====== КНОПКИ ======
document.getElementById('prevSection').addEventListener('click', prevSection);
document.getElementById('nextSection').addEventListener('click', nextSection);
document.getElementById('prevSong').addEventListener('click', prevSong);
document.getElementById('nextSong').addEventListener('click', nextSong);

// ====== КЛАВИАТУРА ======
window.addEventListener('keydown', e => {
  if (["ArrowRight", "PageDown"].includes(e.key)) {
    nextSection(); e.preventDefault();
  } else if (["ArrowLeft", "PageUp"].includes(e.key)) {
    prevSection(); e.preventDefault();
  } else if (["ArrowUp"].includes(e.key)) {
    prevSong(); e.preventDefault();
  } else if (["ArrowDown"].includes(e.key)) {
    nextSong(); e.preventDefault();
  }
});

// ====== ЗАПУСК ======
showSection(0);
window.addEventListener('resize', () => showSection(currentSectionGlobal));

// ====== ПОДДЕРЖКА IPAD + ПУЛЬТ ======
const hiddenInput = document.createElement('input');
hiddenInput.style.opacity = '0';
hiddenInput.style.position = 'fixed';
hiddenInput.style.top = '-100px';
document.body.appendChild(hiddenInput);

// Фокус при загрузке
hiddenInput.focus();

// Возвращаем фокус при любом касании или клике
['touchend', 'click'].forEach(ev =>
  window.addEventListener(ev, () => hiddenInput.focus())
);

// Привязка клавиш пульта к экранным кнопкам
window.addEventListener('keydown', e => {
  const nextBtn = document.getElementById('nextSection');
  const prevBtn = document.getElementById('prevSection');

  if (e.key === 'ArrowRight' || e.key === 'PageDown') {
    nextBtn.click(); // листаем вперёд
    e.preventDefault();
  } else if (e.key === 'ArrowLeft' || e.key === 'PageUp') {
    prevBtn.click(); // листаем назад
    e.preventDefault();
  }
});

</script>

</body>
</html>
